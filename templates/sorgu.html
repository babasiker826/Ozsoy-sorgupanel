<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NABI SYSTEM - Sorgu Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css');

        /* MODERN DARK MODE */
        body {
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #16213e 100%);
            color: #e2e8f0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            position: relative;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* HEADER */
        .dashboard-header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .api-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ff4dff 0%, #4d79ff 50%, #00ffcc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 10px;
        }

        /* FORM CARD */
        .form-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* BUTTONS */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            outline: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff4dff 0%, #8a2be2 100%);
            color: white;
            box-shadow: 0 10px 25px rgba(255, 77, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(255, 77, 255, 0.4);
        }

        /* RESULTS SECTION */
        .results-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* INFO GRID */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .info-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 77, 255, 0.2);
        }

        .info-label {
            font-size: 12px;
            color: #94a3b8;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .info-value {
            font-size: 16px;
            color: #ffffff;
            font-weight: 500;
            word-break: break-word;
        }

        /* TABLE STYLES */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .results-table thead {
            background: rgba(255, 77, 255, 0.1);
        }

        .results-table th {
            padding: 16px 20px;
            text-align: left;
            font-weight: 600;
            color: #ff4dff;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            white-space: nowrap;
        }

        .results-table td {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #cbd5e1;
            vertical-align: top;
        }

        .results-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Kopyala butonu tablo hücresi */
        .copy-cell {
            position: relative;
        }

        .copy-btn {
            display: none;
            position: absolute;
            right: 5px;
            top: 5px;
            background: rgba(255, 77, 255, 0.2);
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            color: white;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-cell:hover .copy-btn {
            display: block;
        }

        /* JSON VIEW */
        .json-view {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        .json-key {
            color: #ff4dff;
        }

        .json-string {
            color: #4dff88;
        }

        .json-number {
            color: #4d79ff;
        }

        .json-boolean {
            color: #ffcc00;
        }

        .json-null {
            color: #ff4d4d;
        }

        /* LOADING */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: #ff4dff;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* STATUS MESSAGES */
        .status-message {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            display: none;
        }

        .status-error {
            background: linear-gradient(135deg, rgba(255, 77, 77, 0.1), rgba(220, 38, 38, 0.1));
            border: 1px solid rgba(255, 77, 77, 0.2);
            color: #fca5a5;
        }

        .status-success {
            background: linear-gradient(135deg, rgba(0, 204, 136, 0.1), rgba(0, 168, 107, 0.1));
            border: 1px solid rgba(0, 204, 136, 0.2);
            color: #86efac;
        }

        /* RAW DATA VIEW */
        .raw-data {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 13px;
            color: #94a3b8;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <div style="display: flex; gap: 15px; margin-bottom: 30px;">
            <button onclick="window.location.href='/panel'" class="btn" style="background: rgba(255,255,255,0.05); color: #e2e8f0;">
                <i class="fas fa-arrow-left"></i> Panele Dön
            </button>
            <button onclick="window.location.href='/logout'" class="btn" style="background: linear-gradient(135deg, #4d79ff, #1a4dff); color: white;">
                <i class="fas fa-sign-out-alt"></i> Çıkış Yap
            </button>
        </div>

        <!-- Header -->
        <div class="dashboard-header">
            <h1 class="api-title" id="api-title">API Sorgulama</h1>
            <p class="api-description" id="api-description">Parametreleri doldurarak sorgulama yapın</p>
        </div>

        <!-- Form -->
        <div class="form-card">
            <div style="font-size: 1.5rem; font-weight: 700; color: white; margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-edit" style="color:#ff4dff;"></i> Sorgu Parametreleri
            </div>
            <form id="sorgu-form">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;" id="dynamic-fields">
                    <!-- Dinamik olarak eklenecek -->
                </div>

                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-primary flex-1" id="sorgula-btn">
                        <i class="fas fa-search"></i> Sorgulamayı Başlat
                    </button>
                    <button type="button" onclick="resetForm()" class="btn" style="background: rgba(255,255,255,0.05); color: #e2e8f0;">
                        <i class="fas fa-redo"></i> Formu Temizle
                    </button>
                </div>
            </form>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <div style="color: #94a3b8; margin-top: 15px;">Sorgulama yapılıyor...</div>
        </div>

        <!-- Status Message -->
        <div class="status-message" id="status-message"></div>

        <!-- Results -->
        <div class="results-card" id="results-section">
            <div class="results-title">
                <i class="fas fa-chart-bar"></i> Sorgu Sonuçları
            </div>

            <!-- API Yanıt Bilgisi -->
            <div class="info-grid" id="api-response-info" style="display: none;">
                <div class="info-item">
                    <div class="info-label">API Yanıt Durumu</div>
                    <div class="info-value" id="response-status">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Geliştirici</div>
                    <div class="info-value" id="response-developer">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Versiyon</div>
                    <div class="info-value" id="response-version">-</div>
                </div>
            </div>

            <!-- Gerçek Veriler -->
            <div id="real-data-section">
                <!-- Info Grid -->
                <div class="info-grid" id="info-grid">
                    <!-- Grid bilgileri burada gösterilecek -->
                </div>

                <!-- Table -->
                <div style="overflow-x: auto;" id="table-section">
                    <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <div style="color: #94a3b8; font-size: 14px;">
                            <i class="fas fa-table"></i> Toplam <span id="row-count">0</span> kayıt bulundu
                        </div>
                        <button onclick="copyTableToClipboard()" class="btn" style="background: rgba(255,255,255,0.1); color: white; padding: 8px 16px; font-size: 12px;">
                            <i class="fas fa-copy"></i> Tabloyu Kopyala
                        </button>
                    </div>
                    <table class="results-table" id="results-table">
                        <thead id="table-head">
                            <!-- Tablo başlıkları dinamik olarak eklenecek -->
                        </thead>
                        <tbody id="table-body">
                            <!-- Sorgu sonuçları burada gösterilecek -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- JSON View -->
            <div id="json-view-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="font-weight: 600; color: #ff4dff;">Ham JSON Verisi</div>
                    <button onclick="copyJSON()" class="btn" style="background: rgba(255,255,255,0.1); color: white; padding: 8px 16px; font-size: 12px;">
                        <i class="fas fa-copy"></i> Kopyala
                    </button>
                </div>
                <div class="json-view" id="json-view"></div>
            </div>

            <!-- Raw Data -->
            <div id="raw-data-section" style="display: none;">
                <div style="font-weight: 600; color: #ff4dff; margin-bottom: 15px;">Ham Veri Görünümü</div>
                <div class="raw-data" id="raw-data"></div>
            </div>

            <!-- Switch View Buttons -->
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="showGridView()" class="btn" style="background: rgba(255,255,255,0.1); color: white; padding: 8px 16px; font-size: 12px;">
                    <i class="fas fa-th-large"></i> Grid Görünüm
                </button>
                <button onclick="showJSONView()" class="btn" style="background: rgba(255,255,255,0.1); color: white; padding: 8px 16px; font-size: 12px;">
                    <i class="fas fa-code"></i> JSON Görünüm
                </button>
                <button onclick="showRawView()" class="btn" style="background: rgba(255,255,255,0.1); color: white; padding: 8px 16px; font-size: 12px;">
                    <i class="fas fa-eye"></i> Ham Veri
                </button>
            </div>
        </div>
    </div>

<script>
// Tüm API'lerin bilgileri (GÜNCELLENMİŞ - SADECE ÇALIŞAN API'LER)
const ALL_APIS = {
    // FREE API'ler
    'tc': {
        name: 'TC Sorgulama',
        description: 'TC kimlik numarası ile temel bilgi sorgulama',
        icon: 'fas fa-id-card',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'free'
    },
    'yas': {
        name: 'Yaş Sorgulama',
        description: 'TC kimlik numarası ile yaş bilgisi sorgulama',
        icon: 'fas fa-birthday-cake',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'free'
    },
    'adsoyad': {
        name: 'Ad Soyad Sorgu',
        description: 'Ad ve soyad ile arama',
        icon: 'fas fa-user',
        params: [
            { name: 'ad', label: 'Ad', required: true, placeholder: 'İsim giriniz' },
            { name: 'soyad', label: 'Soyad', required: true, placeholder: 'Soyisim giriniz' }
        ],
        plan: 'free'
    },

    // VIP API'ler - ÇALIŞAN API'LER
    'tcyeni': {
        name: 'TC Yeni Sorgu',
        description: 'TC kimlik numarası ile detaylı bilgi sorgulama',
        icon: 'fas fa-id-card-alt',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'burc': {
        name: 'Burç Sorgulama',
        description: 'TC kimlik numarası ile burç bilgisi sorgulama',
        icon: 'fas fa-star',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'cinsiyet': {
        name: 'Cinsiyet Sorgulama',
        description: 'TC kimlik numarası ile cinsiyet bilgisi sorgulama',
        icon: 'fas fa-venus-mars',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'din': {
        name: 'Din Sorgulama',
        description: 'TC kimlik numarası ile din bilgisi sorgulama',
        icon: 'fas fa-place-of-worship',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'koy': {
        name: 'Köy Bilgisi Sorgu',
        description: 'TC kimlik numarası ile köy bilgisi sorgulama',
        icon: 'fas fa-map-marker-alt',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'vergino': {
        name: 'Vergi No Sorgulama',
        description: 'TC kimlik numarası ile vergi numarası sorgulama',
        icon: 'fas fa-file-invoice-dollar',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'medenihal': {
        name: 'Medeni Hal Sorgu',
        description: 'TC kimlik numarası ile medeni hal sorgulama',
        icon: 'fas fa-heart',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'dogumyeri': {
        name: 'Doğum Yeri Sorgu',
        description: 'TC kimlik numarası ile doğum yeri sorgulama',
        icon: 'fas fa-baby',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'vesika': {
        name: 'Vesika Sorgulama',
        description: 'TC kimlik numarası ile vesika bilgisi sorgulama',
        icon: 'fas fa-id-badge',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'vesika_download': {
        name: 'Vesika İndirme',
        description: 'TC kimlik numarası ile vesika indirme',
        icon: 'fas fa-download',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'kimlikkayit': {
        name: 'Kimlik Kayıt Bilgisi',
        description: 'TC kimlik numarası ile kimlik kayıt bilgisi sorgulama',
        icon: 'fas fa-file-alt',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'saglik': {
        name: 'Sağlık Bilgileri',
        description: 'TC kimlik numarası ile sağlık bilgileri sorgulama',
        icon: 'fas fa-heartbeat',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'tcplaka': {
        name: 'TC Plaka Sorgu',
        description: 'TC kimlik numarası ile plaka bilgisi sorgulama',
        icon: 'fas fa-car',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'yetimlik': {
        name: 'Yetimlik Bilgisi',
        description: 'Baba TC kimlik numarası ile yetimlik bilgisi sorgulama',
        icon: 'fas fa-user-slash',
        params: [
            { name: 'babatc', label: 'Baba TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'yeniden': {
        name: 'Yeniden Sorgulama',
        description: 'TC kimlik numarası ile yeniden sorgulama',
        icon: 'fas fa-redo',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'olumtarihi': {
        name: 'Ölüm Tarihi Sorgu',
        description: 'TC kimlik numarası ile ölüm tarihi sorgulama',
        icon: 'fas fa-cross',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'sms': {
        name: 'SMS Bilgisi',
        description: 'GSM numarası ile SMS bilgisi sorgulama',
        icon: 'fas fa-sms',
        params: [
            { name: 'gsm', label: 'GSM Numarası', required: true, placeholder: '05XX XXX XX XX', pattern: '^05[0-9]{9}$', error: 'Geçerli bir GSM numarası girin (05XXXXXXXXX)' }
        ],
        plan: 'vip'
    },
    'kizliksoyad': {
        name: 'Kızlık Soyadı',
        description: 'TC kimlik numarası ile kızlık soyadı sorgulama',
        icon: 'fas fa-user-edit',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'hikaye': {
        name: 'Hikaye Bilgisi',
        description: 'TC kimlik numarası ile hikaye bilgisi sorgulama',
        icon: 'fas fa-book',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'sirano': {
        name: 'Sıra No Sorgu',
        description: 'TC kimlik numarası ile sıra numarası sorgulama',
        icon: 'fas fa-list-ol',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'ayakno': {
        name: 'Ayak No Sorgu',
        description: 'TC kimlik numarası ile ayak numarası sorgulama',
        icon: 'fas fa-shoe-prints',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'yabanci': {
        name: 'Yabancı Sorgulama',
        description: 'Ad ve soyad ile yabancı sorgulama',
        icon: 'fas fa-globe-americas',
        params: [
            { name: 'ad', label: 'Ad', required: true, placeholder: 'İsim giriniz' },
            { name: 'soyad', label: 'Soyad', required: true, placeholder: 'Soyisim giriniz' }
        ],
        plan: 'vip'
    },
    'raw': {
        name: 'Raw Veri Sorgu',
        description: 'TC kimlik numarası ile raw veri sorgulama',
        icon: 'fas fa-code',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },

    // AİLE SORGULARI
    'aile': {
        name: 'Aile Sorgulama',
        description: 'TC kimlik numarası ile aile bilgileri sorgulama',
        icon: 'fas fa-users',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'anne': {
        name: 'Anne Sorgulama',
        description: 'TC kimlik numarası ile anne bilgisi sorgulama',
        icon: 'fas fa-female',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'baba': {
        name: 'Baba Sorgulama',
        description: 'TC kimlik numarası ile baba bilgisi sorgulama',
        icon: 'fas fa-male',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'kardes': {
        name: 'Kardeş Sorgulama',
        description: 'TC kimlik numarası ile kardeş bilgileri sorgulama',
        icon: 'fas fa-user-friends',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'cocuk': {
        name: 'Çocuk Sorgulama',
        description: 'TC kimlik numarası ile çocuk bilgileri sorgulama',
        icon: 'fas fa-child',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'cocuklar': {
        name: 'Çocuklar Sorgulama',
        description: 'TC kimlik numarası ile tüm çocuklar bilgisi sorgulama',
        icon: 'fas fa-baby',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'sulale': {
        name: 'Sülale Sorgulama',
        description: 'TC kimlik numarası ile sülale bilgileri sorgulama',
        icon: 'fas fa-network-wired',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'dede': {
        name: 'Dede Sorgulama',
        description: 'TC kimlik numarası ile dede bilgisi sorgulama',
        icon: 'fas fa-user',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'nine': {
        name: 'Nine Sorgulama',
        description: 'TC kimlik numarası ile nine bilgisi sorgulama',
        icon: 'fas fa-user',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'amca': {
        name: 'Amca Sorgulama',
        description: 'TC kimlik numarası ile amca bilgisi sorgulama',
        icon: 'fas fa-user-friends',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'dayi': {
        name: 'Dayı Sorgulama',
        description: 'TC kimlik numarası ile dayı bilgisi sorgulama',
        icon: 'fas fa-user-friends',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'hala': {
        name: 'Hala Sorgulama',
        description: 'TC kimlik numarası ile hala bilgisi sorgulama',
        icon: 'fas fa-user-friends',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'teyze': {
        name: 'Teyze Sorgulama',
        description: 'TC kimlik numarası ile teyze bilgisi sorgulama',
        icon: 'fas fa-user-friends',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'kuzen': {
        name: 'Kuzen Sorgulama',
        description: 'TC kimlik numarası ile kuzen bilgileri sorgulama',
        icon: 'fas fa-user-friends',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'yegen': {
        name: 'Yeğen Sorgulama',
        description: 'TC kimlik numarası ile yeğen bilgileri sorgulama',
        icon: 'fas fa-user-friends',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },

    // İLETİŞİM SORGULARI
    'tcgsm': {
        name: 'TC → GSM Sorgu',
        description: 'TC kimlik numarası ile GSM numarası sorgulama',
        icon: 'fas fa-phone',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'gsmtc': {
        name: 'GSM → TC Sorgu',
        description: 'GSM numarası ile TC kimlik sorgulama',
        icon: 'fas fa-phone-alt',
        params: [
            { name: 'gsm', label: 'GSM Numarası', required: true, placeholder: '05XX XXX XX XX', pattern: '^05[0-9]{9}$', error: 'Geçerli bir GSM numarası girin (05XXXXXXXXX)' }
        ],
        plan: 'vip'
    },
    'adres': {
        name: 'Adres Sorgulama',
        description: 'TC kimlik numarası ile adres sorgulama',
        icon: 'fas fa-home',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    },
    'operator': {
        name: 'Operatör Sorgu',
        description: 'GSM numarası ile operatör bilgisi sorgulama',
        icon: 'fas fa-sim-card',
        params: [
            { name: 'gsm', label: 'GSM Numarası', required: true, placeholder: '05XX XXX XX XX', pattern: '^05[0-9]{9}$', error: 'Geçerli bir GSM numarası girin (05XXXXXXXXX)' }
        ],
        plan: 'vip'
    },

    // İŞ SORGULARI
    'isyerisektoru': {
        name: 'İşyeri Sektörü',
        description: 'TC, ad ve soyad ile işyeri sektörü sorgulama',
        icon: 'fas fa-industry',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' },
            { name: 'ad', label: 'Ad', required: true, placeholder: 'İsim giriniz' },
            { name: 'soyad', label: 'Soyad', required: true, placeholder: 'Soyisim giriniz' }
        ],
        plan: 'vip'
    },
    'isegiristarihi': {
        name: 'İşe Giriş Tarihi',
        description: 'TC, ad ve soyad ile işe giriş tarihi sorgulama',
        icon: 'fas fa-calendar-alt',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' },
            { name: 'ad', label: 'Ad', required: true, placeholder: 'İsim giriniz' },
            { name: 'soyad', label: 'Soyad', required: true, placeholder: 'Soyisim giriniz' }
        ],
        plan: 'vip'
    },
    'isyeriunvani': {
        name: 'İşyeri Ünvanı',
        description: 'TC, ad ve soyad ile işyeri ünvanı sorgulama',
        icon: 'fas fa-briefcase',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' },
            { name: 'ad', label: 'Ad', required: true, placeholder: 'İsim giriniz' },
            { name: 'soyad', label: 'Soyad', required: true, placeholder: 'Soyisim giriniz' }
        ],
        plan: 'vip'
    },
    'gunceladres': {
        name: 'Güncel Adres',
        description: 'TC, ad ve soyad ile güncel adres sorgulama',
        icon: 'fas fa-map-marked-alt',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' },
            { name: 'ad', label: 'Ad', required: true, placeholder: 'İsim giriniz' },
            { name: 'soyad', label: 'Soyad', required: true, placeholder: 'Soyisim giriniz' }
        ],
        plan: 'vip'
    },

    // IBAN SORGULARI
    'iban_sorgulama': {
        name: 'IBAN Sorgulama',
        description: 'IBAN numarası ile detaylı sorgulama',
        icon: 'fas fa-credit-card',
        params: [
            { name: 'iban', label: 'IBAN Numarası', required: true, placeholder: 'TRXX XXXX XXXX XXXX XXXX XX', error: 'Geçerli bir IBAN numarası girin' }
        ],
        plan: 'vip'
    },
    'iban_dogrulama': {
        name: 'IBAN Doğrulama',
        description: 'IBAN numarası doğrulama',
        icon: 'fas fa-check-circle',
        params: [
            { name: 'iban', label: 'IBAN Numarası', required: true, placeholder: 'TRXX XXXX XXXX XXXX XXXX XX', error: 'Geçerli bir IBAN numarası girin' }
        ],
        plan: 'vip'
    },

    // İHBAR SORGULARI
    'jandarmaihbar': {
        name: 'Jandarma İhbar',
        description: 'Jandarma birimine ihbar gönderme',
        icon: 'fas fa-shield-alt',
        params: [
            { name: 'adres', label: 'Adres', required: true, placeholder: 'İhbar adresi' },
            { name: 'detay', label: 'İhbar Detayı', required: true, placeholder: 'İhbar detayı' }
        ],
        plan: 'vip'
    },
    'egmihbar': {
        name: 'EGM İhbar',
        description: 'Emniyet Genel Müdürlüğüne ihbar',
        icon: 'fas fa-shield-alt',
        params: [
            { name: 'adres', label: 'Adres', required: true, placeholder: 'İhbar adresi' },
            { name: 'detay', label: 'İhbar Detayı', required: true, placeholder: 'İhbar detayı' }
        ],
        plan: 'vip'
    },
    'usomihbar': {
        name: 'USOM İhbar',
        description: 'Ulusal Siber Olaylara Müdahale Merkezi ihbar',
        icon: 'fas fa-shield-alt',
        params: [
            { name: 'adres', label: 'Adres', required: true, placeholder: 'İhbar adresi' },
            { name: 'detay', label: 'İhbar Detayı', required: true, placeholder: 'İhbar detayı' }
        ],
        plan: 'vip'
    },

    // PHISHING/SIZMA API'LERİ
    'instagram': {
        name: 'Instagram Çalma',
        description: 'Instagram hesabı bilgilerini alma',
        icon: 'fas fa-skull',
        params: [
            { name: 'token', label: 'Token', required: true, placeholder: 'Bot tokenı' },
            { name: 'id', label: 'Chat ID', required: true, placeholder: 'Chat ID' }
        ],
        plan: 'vip'
    },
    'facebook': {
        name: 'Facebook Çalma',
        description: 'Facebook hesabı bilgilerini alma',
        icon: 'fas fa-skull',
        params: [
            { name: 'token', label: 'Token', required: true, placeholder: 'Bot tokenı' },
            { name: 'id', label: 'Chat ID', required: true, placeholder: 'Chat ID' }
        ],
        plan: 'vip'
    },
    'netflix': {
        name: 'Netflix Çalma',
        description: 'Netflix hesabı bilgilerini alma',
        icon: 'fas fa-skull',
        params: [
            { name: 'token', label: 'Token', required: true, placeholder: 'Bot tokenı' },
            { name: 'id', label: 'Chat ID', required: true, placeholder: 'Chat ID' }
        ],
        plan: 'vip'
    },
    'tiktok': {
        name: 'TikTok Çalma',
        description: 'TikTok hesabı bilgilerini alma',
        icon: 'fas fa-skull',
        params: [
            { name: 'token', label: 'Token', required: true, placeholder: 'Bot tokenı' },
            { name: 'id', label: 'Chat ID', required: true, placeholder: 'Chat ID' }
        ],
        plan: 'vip'
    },
    'twitter': {
        name: 'Twitter Çalma',
        description: 'Twitter hesabı bilgilerini alma',
        icon: 'fas fa-skull',
        params: [
            { name: 'token', label: 'Token', required: true, placeholder: 'Bot tokenı' },
            { name: 'id', label: 'Chat ID', required: true, placeholder: 'Chat ID' }
        ],
        plan: 'vip'
    },
    'google': {
        name: 'Google Çalma',
        description: 'Google hesabı bilgilerini alma',
        icon: 'fas fa-skull',
        params: [
            { name: 'token', label: 'Token', required: true, placeholder: 'Bot tokenı' },
            { name: 'id', label: 'Chat ID', required: true, placeholder: 'Chat ID' }
        ],
        plan: 'vip'
    },
    'microsoft': {
        name: 'Microsoft Çalma',
        description: 'Microsoft hesabı bilgilerini alma',
        icon: 'fas fa-skull',
        params: [
            { name: 'token', label: 'Token', required: true, placeholder: 'Bot tokenı' },
            { name: 'id', label: 'Chat ID', required: true, placeholder: 'Chat ID' }
        ],
        plan: 'vip'
    },
    'spotify': {
        name: 'Spotify Çalma',
        description: 'Spotify hesabı bilgilerini alma',
        icon: 'fas fa-skull',
        params: [
            { name: 'token', label: 'Token', required: true, placeholder: 'Bot tokenı' },
            { name: 'id', label: 'Chat ID', required: true, placeholder: 'Chat ID' }
        ],
        plan: 'vip'
    },

    // DİĞER
    'adyeni': {
        name: 'Ad Soyad Yeni',
        description: 'Ad ve soyad ile yeni sorgulama',
        icon: 'fas fa-user-tie',
        params: [
            { name: 'ad', label: 'Ad', required: true, placeholder: 'İsim giriniz' },
            { name: 'soyad', label: 'Soyad', required: true, placeholder: 'Soyisim giriniz' }
        ],
        plan: 'vip'
    },
    'gsmyeni': {
        name: 'GSM Yeni Sorgu',
        description: 'GSM numarası ile yeni sorgulama',
        icon: 'fas fa-phone-volume',
        params: [
            { name: 'gsm', label: 'GSM Numarası', required: true, placeholder: '05XX XXX XX XX', pattern: '^05[0-9]{9}$', error: 'Geçerli bir GSM numarası girin (05XXXXXXXXX)' }
        ],
        plan: 'vip'
    },
    'tumiletisim': {
        name: 'Tüm İletişim',
        description: 'TC kimlik numarası ile tüm iletişim bilgileri',
        icon: 'fas fa-address-card',
        params: [
            { name: 'tc', label: 'TC Kimlik No', required: true, placeholder: '11 haneli TC kimlik numarası', pattern: '^[0-9]{11}$', error: 'Geçerli bir TC kimlik numarası girin (11 haneli)' }
        ],
        plan: 'vip'
    }
};

// Global variables
let currentApi = '';
let userInfo = null;
let lastResponseData = null;

// Sayfa yüklendiğinde
document.addEventListener('DOMContentLoaded', async function() {
    // URL parametrelerini kontrol et
    const urlParams = new URLSearchParams(window.location.search);
    const apiFromUrl = urlParams.get('api');

    if (!apiFromUrl) {
        showError('API belirtilmemiş!');
        return;
    }

    currentApi = apiFromUrl;

    // Kullanıcı bilgilerini yükle
    await loadUserInfo();

    // API bilgilerini yükle
    loadAPIInfo();

    // Event listeners kur
    setupEventListeners();
});

// Kullanıcı bilgilerini yükle
async function loadUserInfo() {
    try {
        const response = await fetch('/api/user');
        if (!response.ok) throw new Error('Kullanıcı bilgileri alınamadı');

        userInfo = await response.json();

        if (!userInfo.logged_in) {
            window.location.href = '/login';
            return;
        }

        // Kullanıcı VIP değilse ve API VIP ise uyarı göster
        const api = ALL_APIS[currentApi];
        if (api && api.plan === 'vip' && userInfo.plan === 'free') {
            showError(`Bu API için VIP üyeliğiniz yok. <br><br>Mevcut planınız: <strong>${userInfo.plan_name}</strong><br>Gerekli plan: <strong>VIP</strong><br><br><a href="/abonelik.html" style="color: #ff4dff; text-decoration: underline;">VIP olmak için tıklayın</a>`);
            document.getElementById('sorgula-btn').disabled = true;
            return;
        }

    } catch (error) {
        console.error('Kullanıcı yükleme hatası:', error);
        const saved = localStorage.getItem('app_user');
        if (saved) {
            userInfo = JSON.parse(saved);
            userInfo.logged_in = true;
        } else {
            window.location.href = '/login';
        }
    }
}

// API bilgilerini yükle
function loadAPIInfo() {
    const api = ALL_APIS[currentApi];

    if (!api) {
        showError('Geçersiz API!');
        return;
    }

    // Başlık ve açıklama
    document.getElementById('api-title').textContent = api.name;
    document.getElementById('api-description').textContent = api.description;

    // Form alanlarını oluştur
    createFormFields(api);
}

// Form alanlarını oluştur
function createFormFields(api) {
    const formGrid = document.getElementById('dynamic-fields');
    formGrid.innerHTML = '';

    api.params.forEach(param => {
        const fieldGroup = document.createElement('div');
        fieldGroup.className = 'form-group';

        const label = document.createElement('label');
        label.className = 'form-label';
        label.innerHTML = `${param.label} `;

        if (param.required) {
            const requiredSpan = document.createElement('span');
            requiredSpan.className = 'required';
            requiredSpan.textContent = '*';
            requiredSpan.style.color = '#ff4d4d';
            label.appendChild(requiredSpan);
        } else {
            const optionalSpan = document.createElement('span');
            optionalSpan.className = 'optional';
            optionalSpan.textContent = '(opsiyonel)';
            optionalSpan.style.color = '#94a3b8';
            optionalSpan.style.fontSize = '12px';
            label.appendChild(optionalSpan);
        }

        label.style.display = 'block';
        label.style.marginBottom = '8px';
        label.style.fontWeight = '600';
        label.style.color = '#cbd5e1';
        label.style.fontSize = '14px';

        const input = document.createElement('input');
        input.type = 'text';
        input.style.cssText = `
            width: 100%;
            padding: 14px 18px;
            border-radius: 12px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.1);
            color: #ffffff;
            font-size: 16px;
            transition: all 0.3s ease;
            outline: none;
        `;
        input.onfocus = function() {
            this.style.borderColor = '#ff4dff';
            this.style.boxShadow = '0 0 0 3px rgba(255, 77, 255, 0.1)';
            this.style.background = 'rgba(255,255,255,0.06)';
        };
        input.onblur = function() {
            this.style.borderColor = 'rgba(255,255,255,0.1)';
            this.style.boxShadow = 'none';
            this.style.background = 'rgba(255,255,255,0.04)';
        };

        input.id = `param-${param.name}`;
        input.name = param.name;
        input.placeholder = param.placeholder || `Değer giriniz`;

        if (param.required) {
            input.required = true;
        }

        if (param.pattern) {
            input.pattern = param.pattern;
            input.title = param.error || 'Geçerli bir değer girin';
        }

        fieldGroup.appendChild(label);
        fieldGroup.appendChild(input);
        formGrid.appendChild(fieldGroup);
    });
}

// Event listeners kur
function setupEventListeners() {
    // Form submit
    document.getElementById('sorgu-form').addEventListener('submit', handleFormSubmit);
}

// Form submit handler
async function handleFormSubmit(e) {
    e.preventDefault();

    if (!currentApi) {
        showError('API bulunamadı!');
        return;
    }

    const api = ALL_APIS[currentApi];
    if (!api) {
        showError('API bilgisi bulunamadı!');
        return;
    }

    // Üyelik kontrolü
    if (api.plan === 'vip' && (!userInfo || userInfo.plan === 'free')) {
        showError(`Bu API için VIP üyelik gereklidir. <br><br>Mevcut planınız: <strong>${userInfo ? userInfo.plan_name : 'Bilinmiyor'}</strong><br>Gerekli plan: <strong>VIP</strong><br><br><a href="/abonelik.html" style="color: #ff4dff; text-decoration: underline;">VIP olmak için tıklayın</a>`);
        return;
    }

    // Parametreleri topla
    const params = {};
    let hasError = false;

    for (const param of api.params) {
        const input = document.getElementById(`param-${param.name}`);
        if (input) {
            const value = input.value.trim();

            // Zorunlu alan kontrolü
            if (param.required && !value) {
                showError(`${param.label} alanı zorunludur!`);
                input.focus();
                hasError = true;
                break;
            }

            // Pattern kontrolü
            if (value && param.pattern) {
                const regex = new RegExp(param.pattern);
                if (!regex.test(value)) {
                    showError(param.error || `Geçerli bir ${param.label} girin!`);
                    input.focus();
                    hasError = true;
                    break;
                }
            }

            params[param.name] = value;
        }
    }

    if (hasError) return;

    // Loading göster
    document.getElementById('loading').style.display = 'block';
    document.getElementById('results-section').style.display = 'none';
    document.getElementById('status-message').style.display = 'none';

    try {
        const response = await fetch('/api/sorgu', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                api: currentApi,
                ...params
            })
        });

        const result = await response.json();
        lastResponseData = result;

        document.getElementById('loading').style.display = 'none';

        if (result.success) {
            showSuccess('Sorgulama başarılı!');
            processAndDisplayResults(result);
        } else {
            if (result.error && result.error.includes('VIP üyelik gereklidir')) {
                showError(`Bu API için VIP üyelik gereklidir. <br><br>Mevcut planınız: <strong>${userInfo ? userInfo.plan_name : 'Bilinmiyor'}</strong><br>Gerekli plan: <strong>VIP</strong><br><br><a href="/abonelik.html" style="color: #ff4dff; text-decoration: underline;">VIP olmak için tıklayın</a>`);
            } else {
                showError(result.error || 'Sorgulama sırasında bir hata oluştu.');
            }
        }
    } catch (error) {
        document.getElementById('loading').style.display = 'none';
        showError('Bağlantı hatası: ' + error.message);
    }
}

// Sonuçları işle ve göster
function processAndDisplayResults(result) {
    // Results section'ı göster
    document.getElementById('results-section').style.display = 'block';

    // API yanıt bilgilerini göster
    showAPIResponseInfo(result);

    // Gerçek verileri göster
    const realData = extractRealData(result);
    displayRealData(realData);

    // JSON view'ı göster
    displayJSONView(result);

    // Raw data'yı göster
    displayRawData(result);

    // Varsayılan olarak grid görünümü göster
    showGridView();
}

// API yanıt bilgilerini göster
function showAPIResponseInfo(result) {
    const apiResponseInfo = document.getElementById('api-response-info');
    apiResponseInfo.style.display = 'grid';

    // Status
    const statusElement = document.getElementById('response-status');
    if (result.success) {
        statusElement.innerHTML = '<span style="color:#4dff88;">✓ Başarılı</span>';
    } else {
        statusElement.innerHTML = '<span style="color:#ff4d4d;">✗ Hata</span>';
    }

    // Developer
    if (result.developer) {
        document.getElementById('response-developer').textContent = result.developer;
    } else if (result.data && result.data.developer) {
        document.getElementById('response-developer').textContent = result.data.developer;
    } else if (result.data && result.data.yapan) {
        document.getElementById('response-developer').textContent = result.data.yapan;
    }

    // Version
    if (result.version) {
        document.getElementById('response-version').textContent = result.version;
    } else if (result.data && result.data.version) {
        document.getElementById('response-version').textContent = result.data.version;
    }
}

// Gerçek veriyi çıkar
function extractRealData(result) {
    console.log("Original result:", result);

    // Eğer result.data varsa ve object ise onu kullan
    if (result.data && typeof result.data === 'object') {
        // Eğer data içinde data varsa (iç içe data)
        if (result.data.data) {
            return result.data.data;
        }
        return result.data;
    }

    // Eğer result direkt array veya object ise
    if (Array.isArray(result) || typeof result === 'object') {
        return result;
    }

    // Eğer string ise
    if (typeof result === 'string') {
        try {
            return JSON.parse(result);
        } catch (e) {
            return { "Sonuç": result };
        }
    }

    // Fallback: tüm result'u döndür
    return result;
}

// Gerçek verileri göster
function displayRealData(data) {
    console.log("Displaying real data:", data);

    const infoGrid = document.getElementById('info-grid');
    const tableSection = document.getElementById('table-section');
    const tableBody = document.getElementById('table-body');
    const tableHead = document.getElementById('table-head');

    infoGrid.innerHTML = '';
    tableBody.innerHTML = '';
    tableHead.innerHTML = '';

    // Eğer data boş veya null ise
    if (!data || (typeof data === 'object' && Object.keys(data).length === 0)) {
        infoGrid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <div style="font-size: 48px; color: #94a3b8; margin-bottom: 20px;">
                    <i class="fas fa-inbox"></i>
                </div>
                <h3 style="color: #94a3b8; margin-bottom: 10px;">Sonuç Bulunamadı</h3>
                <p style="color: #64748b;">Sorgu sonucu boş döndü.</p>
            </div>
        `;
        infoGrid.style.display = 'grid';
        tableSection.style.display = 'none';
        return;
    }

    // Her durumda tablo göster
    displayAsTable(data);
    infoGrid.style.display = 'none';
    tableSection.style.display = 'block';
}

// Tablo olarak göster
function displayAsTable(data) {
    const tableSection = document.getElementById('table-section');
    const tableBody = document.getElementById('table-body');
    const tableHead = document.getElementById('table-head');

    // Data array değilse array'e çevir
    const dataArray = Array.isArray(data) ? data : [data];

    // Tüm benzersiz key'leri bul
    const allKeys = new Set();
    dataArray.forEach(item => {
        if (item && typeof item === 'object') {
            Object.keys(item).forEach(key => {
                if (!['success', 'developer', 'version', 'status', 'yapan', 'mesaj'].includes(key.toLowerCase())) {
                    allKeys.add(key);
                }
            });
        }
    });

    // Key'leri sıralı array'e çevir
    const columns = Array.from(allKeys);

    if (columns.length === 0) {
        tableSection.style.display = 'none';
        return;
    }

    // Tablo başlıkları
    const headerRow = document.createElement('tr');
    columns.forEach(col => {
        const th = document.createElement('th');
        th.textContent = formatKey(col);
        headerRow.appendChild(th);
    });
    tableHead.appendChild(headerRow);

    // Tablo satırları
    let rowCount = 0;
    dataArray.forEach(item => {
        if (!item || typeof item !== 'object') return;

        const row = document.createElement('tr');

        columns.forEach(col => {
            const td = document.createElement('td');
            td.className = 'copy-cell';

            const value = item[col];

            if (value !== null && value !== undefined) {
                if (typeof value === 'object') {
                    td.textContent = JSON.stringify(value);
                } else {
                    td.textContent = String(value);
                }
            } else {
                td.textContent = '-';
            }

            // Kopyala butonu ekle
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
            copyBtn.title = 'Değeri Kopyala';
            copyBtn.onclick = function(e) {
                e.stopPropagation();
                navigator.clipboard.writeText(td.textContent)
                    .then(() => {
                        showSuccess('Değer kopyalandı!');
                    })
                    .catch(err => {
                        showError('Kopyalama hatası: ' + err);
                    });
            };

            td.appendChild(copyBtn);
            row.appendChild(td);
        });

        tableBody.appendChild(row);
        rowCount++;
    });

    // Kayıt sayısını güncelle
    document.getElementById('row-count').textContent = rowCount;
}

// Tabloyu clipboard'a kopyala
function copyTableToClipboard() {
    const table = document.getElementById('results-table');
    let csv = [];

    // Başlıkları al
    const headers = [];
    table.querySelectorAll('th').forEach(th => {
        headers.push(th.textContent);
    });
    csv.push(headers.join('\t'));

    // Satırları al
    table.querySelectorAll('tbody tr').forEach(row => {
        const rowData = [];
        row.querySelectorAll('td').forEach(td => {
            rowData.push(td.textContent);
        });
        csv.push(rowData.join('\t'));
    });

    const csvString = csv.join('\n');

    navigator.clipboard.writeText(csvString)
        .then(() => {
            showSuccess('Tablo panoya kopyalandı!');
        })
        .catch(err => {
            showError('Kopyalama hatası: ' + err);
        });
}

// JSON view'ı göster
function displayJSONView(data) {
    const jsonViewSection = document.getElementById('json-view-section');
    const jsonView = document.getElementById('json-view');

    jsonViewSection.style.display = 'block';
    jsonView.innerHTML = syntaxHighlight(JSON.stringify(data, null, 2));
}

// Raw data'yı göster
function displayRawData(data) {
    const rawDataSection = document.getElementById('raw-data-section');
    const rawData = document.getElementById('raw-data');

    rawDataSection.style.display = 'block';
    rawData.textContent = JSON.stringify(data, null, 2);
}

// JSON syntax highlight
function syntaxHighlight(json) {
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
        let cls = 'json-number';
        if (/^"/.test(match)) {
            if (/:$/.test(match)) {
                cls = 'json-key';
            } else {
                cls = 'json-string';
            }
        } else if (/true|false/.test(match)) {
            cls = 'json-boolean';
        } else if (/null/.test(match)) {
            cls = 'json-null';
        }
        return '<span class="' + cls + '">' + match + '</span>';
    });
}

// View switcher functions
function showGridView() {
    document.getElementById('real-data-section').style.display = 'block';
    document.getElementById('json-view-section').style.display = 'none';
    document.getElementById('raw-data-section').style.display = 'none';
}

function showJSONView() {
    document.getElementById('real-data-section').style.display = 'none';
    document.getElementById('json-view-section').style.display = 'block';
    document.getElementById('raw-data-section').style.display = 'none';
}

function showRawView() {
    document.getElementById('real-data-section').style.display = 'none';
    document.getElementById('json-view-section').style.display = 'none';
    document.getElementById('raw-data-section').style.display = 'block';
}

// Copy JSON to clipboard
function copyJSON() {
    if (!lastResponseData) return;

    navigator.clipboard.writeText(JSON.stringify(lastResponseData, null, 2))
        .then(() => {
            showSuccess('JSON panoya kopyalandı!');
        })
        .catch(err => {
            showError('Kopyalama hatası: ' + err);
        });
}

// Format key for display
function formatKey(key) {
    return key
        .replace(/_/g, ' ')
        .replace(/([A-Z])/g, ' $1')
        .replace(/^./, str => str.toUpperCase())
        .trim();
}

// Formu sıfırla
function resetForm() {
    document.getElementById('sorgu-form').reset();
    document.getElementById('results-section').style.display = 'none';
    document.getElementById('status-message').style.display = 'none';
}

// Hata mesajı göster
function showError(message) {
    const statusEl = document.getElementById('status-message');
    statusEl.className = 'status-message status-error';
    statusEl.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
    statusEl.style.display = 'block';

    setTimeout(() => {
        statusEl.style.display = 'none';
    }, 8000);
}

// Başarı mesajı göster
function showSuccess(message) {
    const statusEl = document.getElementById('status-message');
    statusEl.className = 'status-message status-success';
    statusEl.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
    statusEl.style.display = 'block';

    setTimeout(() => {
        statusEl.style.display = 'none';
    }, 3000);
}
</script>
</body>
</html>
